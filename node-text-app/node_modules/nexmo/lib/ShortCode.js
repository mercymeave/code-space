"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _Utils = _interopRequireDefault(require("./Utils"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var querystring = require("querystring");
/**
 * Provides access to the `ShortCode` endpoint.
 */


class ShortCode {
  static get PATH() {
    return "/sc/us/${type}/json";
  }

  static get ERROR_MESSAGES() {
    return {
      to: "Invalid to address",
      msgParams: "Invalid shortcode message parameters"
    };
  }
  /**
   * @param {Credentials} credentials
   *    credentials to be used when interacting with the API.
   * @param {Object} options
   *    Additional ShortCode options.
   */


  constructor(credentials) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    this.creds = credentials;
    this.options = options;
  }

  _sendRequest(endpoint, method, callback) {
    endpoint.path = endpoint.path + (endpoint.path.indexOf("?") > 0 ? "&" : "?") + querystring.stringify({
      api_key: this.creds.apiKey,
      api_secret: this.creds.apiSecret
    });
    this.options.httpClient.request(endpoint, method, callback);
  }

  _sendViaShortcode(type, recipient, messageParams, opts, callback) {
    if (!recipient) {
      _Utils.default.sendError(callback, new Error(ShortCode.ERROR_MESSAGES.to));
    }

    if (!messageParams || !Object.keys(messageParams)) {
      _Utils.default.sendError(callback, new Error(ShortCode.ERROR_MESSAGES.msgParams));
    }

    opts = opts || {};
    var path = ShortCode.PATH.replace("${type}", type);
    Object.keys(messageParams).forEach(function (key) {
      opts[key] = messageParams[key];
    });
    opts.to = recipient;
    path += "?" + querystring.stringify(opts);
    this.options.logger.info("sending message from shortcode " + type + " to " + recipient + " with parameters " + JSON.stringify(messageParams));

    this._sendRequest({
      host: this.options.restHost || "rest.nexmo.com",
      path: path
    }, "POST", function (err, apiResponse) {
      if (!err && apiResponse.status && apiResponse.messages[0].status > 0) {
        _Utils.default.sendError(callback, new Error(apiResponse.messages[0]["error-text"]), apiResponse);
      } else {
        if (callback) callback(err, apiResponse);
      }
    });
  }

  shortcodeAlert(recipient, messageParams, opts, callback) {
    this._sendViaShortcode("alert", recipient, messageParams, opts, callback);
  }

  shortcode2FA(recipient, messageParams, opts, callback) {
    this._sendViaShortcode("2fa", recipient, messageParams, opts, callback);
  }

  shortcodeMarketing(recipient, messageParams, opts, callback) {
    this._sendViaShortcode("marketing", recipient, messageParams, opts, callback);
  }

}

var _default = ShortCode;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9TaG9ydENvZGUuanMiXSwibmFtZXMiOlsicXVlcnlzdHJpbmciLCJyZXF1aXJlIiwiU2hvcnRDb2RlIiwiUEFUSCIsIkVSUk9SX01FU1NBR0VTIiwidG8iLCJtc2dQYXJhbXMiLCJjb25zdHJ1Y3RvciIsImNyZWRlbnRpYWxzIiwib3B0aW9ucyIsImNyZWRzIiwiX3NlbmRSZXF1ZXN0IiwiZW5kcG9pbnQiLCJtZXRob2QiLCJjYWxsYmFjayIsInBhdGgiLCJpbmRleE9mIiwic3RyaW5naWZ5IiwiYXBpX2tleSIsImFwaUtleSIsImFwaV9zZWNyZXQiLCJhcGlTZWNyZXQiLCJodHRwQ2xpZW50IiwicmVxdWVzdCIsIl9zZW5kVmlhU2hvcnRjb2RlIiwidHlwZSIsInJlY2lwaWVudCIsIm1lc3NhZ2VQYXJhbXMiLCJvcHRzIiwiVXRpbHMiLCJzZW5kRXJyb3IiLCJFcnJvciIsIk9iamVjdCIsImtleXMiLCJyZXBsYWNlIiwiZm9yRWFjaCIsImtleSIsImxvZ2dlciIsImluZm8iLCJKU09OIiwiaG9zdCIsInJlc3RIb3N0IiwiZXJyIiwiYXBpUmVzcG9uc2UiLCJzdGF0dXMiLCJtZXNzYWdlcyIsInNob3J0Y29kZUFsZXJ0Iiwic2hvcnRjb2RlMkZBIiwic2hvcnRjb2RlTWFya2V0aW5nIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztBQUVBOzs7O0FBRUEsSUFBSUEsV0FBVyxHQUFHQyxPQUFPLENBQUMsYUFBRCxDQUF6QjtBQUVBOzs7OztBQUdBLE1BQU1DLFNBQU4sQ0FBZ0I7QUFDZCxhQUFXQyxJQUFYLEdBQWtCO0FBQ2hCLFdBQU8scUJBQVA7QUFDRDs7QUFFRCxhQUFXQyxjQUFYLEdBQTRCO0FBQzFCLFdBQU87QUFDTEMsTUFBQUEsRUFBRSxFQUFFLG9CQURDO0FBRUxDLE1BQUFBLFNBQVMsRUFBRTtBQUZOLEtBQVA7QUFJRDtBQUVEOzs7Ozs7OztBQU1BQyxFQUFBQSxXQUFXLENBQUNDLFdBQUQsRUFBNEI7QUFBQSxRQUFkQyxPQUFjLHVF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LEVBQU1DLFdBQU4sQ0FBUjtBQUNmO0FBQ0YsS0FoQkg7QUFrQkQ7O0FBRURHLEVBQUFBLGNBQWMsQ0FBQ3BCLFNBQUQsRUFBWUMsYUFBWixFQUEyQkMsSUFBM0IsRUFBaUNkLFFBQWpDLEVBQTJDO0FBQ3ZELFNBQUtVLGlCQUFMLENBQXVCLE9BQXZCLEVBQWdDRSxTQUFoQyxFQUEyQ0MsYUFBM0MsRUFBMERDLElBQTFELEVBQWdFZCxRQUFoRTtBQUNEOztBQUNEaUMsRUFBQUEsWUFBWSxDQUFDckIsU0FBRCxFQUFZQyxhQUFaLEVBQTJCQyxJQUEzQixFQUFpQ2QsUUFBakMsRUFBMkM7QUFDckQsU0FBS1UsaUJBQUwsQ0FBdUIsS0FBdkIsRUFBOEJFLFNBQTlCLEVBQXlDQyxhQUF6QyxFQUF3REMsSUFBeEQsRUFBOERkLFFBQTlEO0FBQ0Q7O0FBQ0RrQyxFQUFBQSxrQkFBa0IsQ0FBQ3RCLFNBQUQsRUFBWUMsYUFBWixFQUEyQkMsSUFBM0IsRUFBaUNkLFFBQWpDLEVBQTJDO0FBQzNELFNBQUtVLGlCQUFMLENBQ0UsV0FERixFQUVFRSxTQUZGLEVBR0VDLGFBSEYsRUFJRUMsSUFKRixFQUtFZCxRQUxGO0FBT0Q7O0FBMUZhOztlQTZGRFosUyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgVXRpbHMgZnJvbSBcIi4vVXRpbHNcIjtcblxudmFyIHF1ZXJ5c3RyaW5nID0gcmVxdWlyZShcInF1ZXJ5c3RyaW5nXCIpO1xuXG4vKipcbiAqIFByb3ZpZGVzIGFjY2VzcyB0byB0aGUgYFNob3J0Q29kZWAgZW5kcG9pbnQuXG4gKi9cbmNsYXNzIFNob3J0Q29kZSB7XG4gIHN0YXRpYyBnZXQgUEFUSCgpIHtcbiAgICByZXR1cm4gXCIvc2MvdXMvJHt0eXBlfS9qc29uXCI7XG4gIH1cblxuICBzdGF0aWMgZ2V0IEVSUk9SX01FU1NBR0VTKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0bzogXCJJbnZhbGlkIHRvIGFkZHJlc3NcIixcbiAgICAgIG1zZ1BhcmFtczogXCJJbnZhbGlkIHNob3J0Y29kZSBtZXNzYWdlIHBhcmFtZXRlcnNcIlxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQHBhcmFtIHtDcmVkZW50aWFsc30gY3JlZGVudGlhbHNcbiAgICogICAgY3JlZGVudGlhbHMgdG8gYmUgdXNlZCB3aGVuIGludGVyYWN0aW5nIHdpdGggdGhlIEFQSS5cbiAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnNcbiAgICogICAgQWRkaXRpb25hbCBTaG9ydENvZGUgb3B0aW9ucy5cbiAgICovXG4gIGNvbnN0cnVjdG9yKGNyZWRlbnRpYWxzLCBvcHRpb25zID0ge30pIHtcbiAgICB0aGlzLmNyZWRzID0gY3JlZGVudGlhbHM7XG4gICAgdGhpcy5vcHRpb25zID0gb3B0aW9ucztcbiAgfVxuXG4gIF9zZW5kUmVxdWVzdChlbmRwb2ludCwgbWV0aG9kLCBjYWxsYmFjaykge1xuICAgIGVuZHBvaW50LnBhdGggPVxuICAgICAgZW5kcG9pbnQucGF0aCArXG4gICAgICAoZW5kcG9pbnQucGF0aC5pbmRleE9mKFwiP1wiKSA+IDAgPyBcIiZcIiA6IFwiP1wiKSArXG4gICAgICBxdWVyeXN0cmluZy5zdHJpbmdpZnkoe1xuICAgICAgICBhcGlfa2V5OiB0aGlzLmNyZWRzLmFwaUtleSxcbiAgICAgICAgYXBpX3NlY3JldDogdGhpcy5jcmVkcy5hcGlTZWNyZXRcbiAgICAgIH0pO1xuICAgIHRoaXMub3B0aW9ucy5odHRwQ2xpZW50LnJlcXVlc3QoZW5kcG9pbnQsIG1ldGhvZCwgY2FsbGJhY2spO1xuICB9XG5cbiAgX3NlbmRWaWFTaG9ydGNvZGUodHlwZSwgcmVjaXBpZW50LCBtZXNzYWdlUGFyYW1zLCBvcHRzLCBjYWxsYmFjaykge1xuICAgIGlmICghcmVjaXBpZW50KSB7XG4gICAgICBVdGlscy5zZW5kRXJyb3IoY2FsbGJhY2ssIG5ldyBFcnJvcihTaG9ydENvZGUuRVJST1JfTUVTU0FHRVMudG8pKTtcbiAgICB9XG4gICAgaWYgKCFtZXNzYWdlUGFyYW1zIHx8ICFPYmplY3Qua2V5cyhtZXNzYWdlUGFyYW1zKSkge1xuICAgICAgVXRpbHMuc2VuZEVycm9yKGNhbGxiYWNrLCBuZXcgRXJyb3IoU2hvcnRDb2RlLkVSUk9SX01FU1NBR0VTLm1zZ1BhcmFtcykpO1xuICAgIH1cbiAgICBvcHRzID0gb3B0cyB8fCB7fTtcbiAgICB2YXIgcGF0aCA9IFNob3J0Q29kZS5QQVRILnJlcGxhY2UoXCIke3R5cGV9XCIsIHR5cGUpO1xuICAgIE9iamVjdC5rZXlzKG1lc3NhZ2VQYXJhbXMpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7XG4gICAgICBvcHRzW2tleV0gPSBtZXNzYWdlUGFyYW1zW2tleV07XG4gICAgfSk7XG4gICAgb3B0cy50byA9IHJlY2lwaWVudDtcbiAgICBwYXRoICs9IFwiP1wiICsgcXVlcnlzdHJpbmcuc3RyaW5naWZ5KG9wdHMpO1xuICAgIHRoaXMub3B0aW9ucy5sb2dnZXIuaW5mbyhcbiAgICAgIFwic2VuZGluZyBtZXNzYWdlIGZyb20gc2hvcnRjb2RlIFwiICtcbiAgICAgICAgdHlwZSArXG4gICAgICAgIFwiIHRvIFwiICtcbiAgICAgICAgcmVjaXBpZW50ICtcbiAgICAgICAgXCIgd2l0aCBwYXJhbWV0ZXJzIFwiICtcbiAgICAgICAgSlNPTi5zdHJpbmdpZnkobWVzc2FnZVBhcmFtcylcbiAgICApO1xuICAgIHRoaXMuX3NlbmRSZXF1ZXN0KFxuICAgICAge1xuICAgICAgICBob3N0OiB0aGlzLm9wdGlvbnMucmVzdEhvc3QgfHwgXCJyZXN0Lm5leG1vLmNvbVwiLFxuICAgICAgICBwYXRoOiBwYXRoXG4gICAgICB9LFxuICAgICAgXCJQT1NUXCIsXG4gICAgICBmdW5jdGlvbihlcnIsIGFwaVJlc3BvbnNlKSB7XG4gICAgICAgIGlmICghZXJyICYmIGFwaVJlc3BvbnNlLnN0YXR1cyAmJiBhcGlSZXNwb25zZS5tZXNzYWdlc1swXS5zdGF0dXMgPiAwKSB7XG4gICAgICAgICAgVXRpbHMuc2VuZEVycm9yKFxuICAgICAgICAgICAgY2FsbGJhY2ssXG4gICAgICAgICAgICBuZXcgRXJyb3IoYXBpUmVzcG9uc2UubWVzc2FnZXNbMF1bXCJlcnJvci10ZXh0XCJdKSxcbiAgICAgICAgICAgIGFwaVJlc3BvbnNlXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKGVyciwgYXBpUmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIHNob3J0Y29kZUFsZXJ0KHJlY2lwaWVudCwgbWVzc2FnZVBhcmFtcywgb3B0cywgY2FsbGJhY2spIHtcbiAgICB0aGlzLl9zZW5kVmlhU2hvcnRjb2RlKFwiYWxlcnRcIiwgcmVjaXBpZW50LCBtZXNzYWdlUGFyYW1zLCBvcHRzLCBjYWxsYmFjayk7XG4gIH1cbiAgc2hvcnRjb2RlMkZBKHJlY2lwaWVudCwgbWVzc2FnZVBhcmFtcywgb3B0cywgY2FsbGJhY2spIHtcbiAgICB0aGlzLl9zZW5kVmlhU2hvcnRjb2RlKFwiMmZhXCIsIHJlY2lwaWVudCwgbWVzc2FnZVBhcmFtcywgb3B0cywgY2FsbGJhY2spO1xuICB9XG4gIHNob3J0Y29kZU1hcmtldGluZyhyZWNpcGllbnQsIG1lc3NhZ2VQYXJhbXMsIG9wdHMsIGNhbGxiYWNrKSB7XG4gICAgdGhpcy5fc2VuZFZpYVNob3J0Y29kZShcbiAgICAgIFwibWFya2V0aW5nXCIsXG4gICAgICByZWNpcGllbnQsXG4gICAgICBtZXNzYWdlUGFyYW1zLFxuICAgICAgb3B0cyxcbiAgICAgIGNhbGxiYWNrXG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBTaG9ydENvZGU7XG4iXX0=