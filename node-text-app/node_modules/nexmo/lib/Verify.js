"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _Utils = _interopRequireDefault(require("./Utils"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class Verify {
  static get PATH() {
    return "/verify{action}/json";
  }

  static get ERROR_MESSAGES() {
    return {
      verifyValidation: "Missing Mandatory fields (number and/or brand)",
      checkVerifyValidation: "Missing Mandatory fields (request_id and/or code)",
      controlVerifyValidation: "Missing Mandatory fields (request_id and/or cmd-command)",
      searchVerifyValidation: "Missing Mandatory fields (request_id or request_ids)"
    };
  }
  /**
   * @param {Credentials} credentials
   *    credentials to be used when interacting with the API.
   * @param {Object} options
   *    Addition Verify options.
   */


  constructor(credentials) {
    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
    this.creds = credentials;
    this.options = options;
  }
  /**
   * TODO: document
   */


  request(inputParams, callback) {
    if (!inputParams.number || !inputParams.brand) {
      _Utils.default.sendError(callback, new Error(Verify.ERROR_MESSAGES.verifyValidation));
    } else {
      inputParams["api_key"] = this.creds.apiKey;
      inputParams["api_secret"] = this.creds.apiSecret;
      this.options.httpClient.request({
        host: this.options.apiHost || "api.nexmo.com",
        path: _Utils.default.createPathWithQuery("".concat(Verify.PATH.replace("{action}", "")), inputParams)
      }, callback);
    }
  }
  /**
   * TODO: document
   */


  psd2(inputParams, callback) {
    inputParams["api_key"] = this.creds.apiKey;
    inputParams["api_secret"] = this.creds.apiSecret;
    this.options.httpClient.request({
      host: this.options.apiHost || "api.nexmo.com",
      path: _Utils.default.createPathWithQuery("".concat(Verify.PATH.replace("{action}", "/psd2")), inputParams)
    }, callback);
  }
  /**
   * TODO: document
   */


  check(inputParams, callback) {
    if (!inputParams.request_id || !inputParams.code) {
      _Utils.default.sendError(callback, new Error(Verify.ERROR_MESSAGES.checkVerifyValidation));
    } else {
      inputParams["api_key"] = this.creds.apiKey;
      inputParams["api_secret"] = this.creds.apiSecret;
      this.options.httpClient.request({
        host: this.options.apiHost || "api.nexmo.com",
        path: _Utils.default.createPathWithQuery("".concat(Verify.PATH.replace("{action}", "/check")), inputParams)
      }, callback);
    }
  }
  /**
   * TODO: document
   */


  control(inputParams, callback) {
    if (!inputParams.request_id || !inputParams.cmd) {
      _Utils.default.sendError(callback, new Error(Verify.ERROR_MESSAGES.controlVerifyValidation));
    } else {
      inputParams["api_key"] = this.creds.apiKey;
      inputParams["api_secret"] = this.creds.apiSecret;
      this.options.httpClient.request({
        host: this.options.apiHost || "api.nexmo.com",
        path: _Utils.default.createPathWithQuery("".concat(Verify.PATH.replace("{action}", "/control")), inputParams)
      }, callback);
    }
  }
  /**
   * TODO: document
   */


  search(requestIds, callback) {
    var requestIdParam = {};

    if (!requestIds) {
      _Utils.default.sendError(callback, new Error(Verify.ERROR_MESSAGES.searchVerifyValidation));
    } else {
      if (Array.isArray(requestIds)) {
        if (requestIds.length === 1) {
          requestIdParam.request_id = requestIds;
        } else {
          requestIdParam.request_ids = requestIds;
        }
      } else {
        requestIdParam.request_id = requestIds;
      }

      requestIdParam["api_key"] = this.creds.apiKey;
      requestIdParam["api_secret"] = this.creds.apiSecret;
      this.options.httpClient.request({
        host: this.options.apiHost || "api.nexmo.com",
        path: _Utils.default.createPathWithQuery("".concat(Verify.PATH.replace("{action}", "/search")), requestIdParam)
      }, callback);
    }
  }

}

var _default = Verify;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9WZXJpZnkuanMiXSwibmFtZXMiOlsiVmVyaWZ5IiwiUEFUSCIsIkVSUk9SX01FU1NBR0VTIiwidmVyaWZ5VmFsaWRhdGlvbiIsImNoZWNrVmVyaWZ5VmFsaWRhdGlvbiIsImNvbnRyb2xWZXJpZnlWYWxpZGF0aW9uIiwic2VhcmNoVmVyaWZ5VmFsaWRhdGlvbiIsImNvbnN0cnVjdG9yIiwiY3JlZGVudGlhbHMiLCJvcHRpb25zIiwiY3JlZHMiLCJyZXF1ZXN0IiwiaW5wdXRQYXJhbXMiLCJjYWxsYmFjayIsIm51bWJlciIsImJyYW5kIiwiVXRpbHMiLCJzZW5kRXJyb3IiLCJFcnJvciIsImFwaUtleSIsImFwaVNlY3JldCIsImh0dHBDbGllbnQiLCJob3N0IiwiYXBpSG9zdCIsInBhdGgiLCJjcmVhdGVQYXRoV2l0aFF1ZXJ5IiwicmVwbGFjZSIsInBzZDIiLCJjaGVjayIsInJlcXVlc3RfaWQiLCJjb2RlIiwiY29udHJvbCIsImNtZCIsInNlYXJjaCIsInJlcXVlc3RJZHMiLCJyZXF1ZXN0SWRQYXJhbSIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsInJlcXVlc3RfaWRzIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztBQUVBOzs7O0FBRUEsTUFBTUEsTUFBTixDQUFhO0FBQ1gsYUFBV0MsSUFBWCxHQUFrQjtBQUNoQixXQUFPLHNCQUFQO0FBQ0Q7O0FBRUQsYUFBV0MsY0FBWCxHQUE0QjtBQUMxQixXQUFPO0FBQ0xDLE1BQUFBLGdCQUFnQixFQUFFLGdEQURiO0FBRUxDLE1BQUFBLHFCQUFxQixFQUNuQixtREFIRztBQUlMQyxNQUFBQSx1QkFBdUIsRUFDckIsMERBTEc7QUFNTEMsTUFBQUEsc0JBQXNCLEVBQ3BCO0FBUEcsS0FBUDtBQVNEO0FBQ0Q7Ozs7Ozs7O0FBTUFDLEVBQUFBLFdBQVcsQ0FBQ0MsV0FBRCxFQUE0QjtBQUFBLFFBQWRDLE9BQWMsdUVBQUosRUFBSTtBQUNyQyxTQUFLQyxLQUFMLEdBQWFGLFdBQWI7QUFDQSxTQUFL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QUEsY0FBYyxDQUFDLFNBQUQsQ0FBZCxHQUE0QixLQUFLekIsS0FBTCxDQUFXUyxNQUF2QztBQUNBZ0IsTUFBQUEsY0FBYyxDQUFDLFlBQUQsQ0FBZCxHQUErQixLQUFLekIsS0FBTCxDQUFXVSxTQUExQztBQUNBLFdBQUtYLE9BQUwsQ0FBYVksVUFBYixDQUF3QlYsT0FBeEIsQ0FDRTtBQUNFVyxRQUFBQSxJQUFJLEVBQUUsS0FBS2IsT0FBTCxDQUFhYyxPQUFiLElBQXdCLGVBRGhDO0FBRUVDLFFBQUFBLElBQUksRUFBRVIsZUFBTVMsbUJBQU4sV0FDRHpCLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZeUIsT0FBWixDQUFvQixVQUFwQixFQUFnQyxTQUFoQyxDQURDLEdBRUpTLGNBRkk7QUFGUixPQURGLEVBUUV0QixRQVJGO0FBVUQ7QUFDRjs7QUF6SlU7O2VBNEpFYixNIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCBVdGlscyBmcm9tIFwiLi9VdGlsc1wiO1xuXG5jbGFzcyBWZXJpZnkge1xuICBzdGF0aWMgZ2V0IFBBVEgoKSB7XG4gICAgcmV0dXJuIFwiL3ZlcmlmeXthY3Rpb259L2pzb25cIjtcbiAgfVxuXG4gIHN0YXRpYyBnZXQgRVJST1JfTUVTU0FHRVMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHZlcmlmeVZhbGlkYXRpb246IFwiTWlzc2luZyBNYW5kYXRvcnkgZmllbGRzIChudW1iZXIgYW5kL29yIGJyYW5kKVwiLFxuICAgICAgY2hlY2tWZXJpZnlWYWxpZGF0aW9uOlxuICAgICAgICBcIk1pc3NpbmcgTWFuZGF0b3J5IGZpZWxkcyAocmVxdWVzdF9pZCBhbmQvb3IgY29kZSlcIixcbiAgICAgIGNvbnRyb2xWZXJpZnlWYWxpZGF0aW9uOlxuICAgICAgICBcIk1pc3NpbmcgTWFuZGF0b3J5IGZpZWxkcyAocmVxdWVzdF9pZCBhbmQvb3IgY21kLWNvbW1hbmQpXCIsXG4gICAgICBzZWFyY2hWZXJpZnlWYWxpZGF0aW9uOlxuICAgICAgICBcIk1pc3NpbmcgTWFuZGF0b3J5IGZpZWxkcyAocmVxdWVzdF9pZCBvciByZXF1ZXN0X2lkcylcIlxuICAgIH07XG4gIH1cbiAgLyoqXG4gICAqIEBwYXJhbSB7Q3JlZGVudGlhbHN9IGNyZWRlbnRpYWxzXG4gICAqICAgIGNyZWRlbnRpYWxzIHRvIGJlIHVzZWQgd2hlbiBpbnRlcmFjdGluZyB3aXRoIHRoZSBBUEkuXG4gICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zXG4gICAqICAgIEFkZGl0aW9uIFZlcmlmeSBvcHRpb25zLlxuICAgKi9cbiAgY29uc3RydWN0b3IoY3JlZGVudGlhbHMsIG9wdGlvbnMgPSB7fSkge1xuICAgIHRoaXMuY3JlZHMgPSBjcmVkZW50aWFscztcbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIFRPRE86IGRvY3VtZW50XG4gICAqL1xuICByZXF1ZXN0KGlucHV0UGFyYW1zLCBjYWxsYmFjaykge1xuICAgIGlmICghaW5wdXRQYXJhbXMubnVtYmVyIHx8ICFpbnB1dFBhcmFtcy5icmFuZCkge1xuICAgICAgVXRpbHMuc2VuZEVycm9yKFxuICAgICAgICBjYWxsYmFjayxcbiAgICAgICAgbmV3IEVycm9yKFZlcmlmeS5FUlJPUl9NRVNTQUdFUy52ZXJpZnlWYWxpZGF0aW9uKVxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaW5wdXRQYXJhbXNbXCJhcGlfa2V5XCJdID0gdGhpcy5jcmVkcy5hcGlLZXk7XG4gICAgICBpbnB1dFBhcmFtc1tcImFwaV9zZWNyZXRcIl0gPSB0aGlzLmNyZWRzLmFwaVNlY3JldDtcbiAgICAgIHRoaXMub3B0aW9ucy5odHRwQ2xpZW50LnJlcXVlc3QoXG4gICAgICAgIHtcbiAgICAgICAgICBob3N0OiB0aGlzLm9wdGlvbnMuYXBpSG9zdCB8fCBcImFwaS5uZXhtby5jb21cIixcbiAgICAgICAgICBwYXRoOiBVdGlscy5jcmVhdGVQYXRoV2l0aFF1ZXJ5KFxuICAgICAgICAgICAgYCR7VmVyaWZ5LlBBVEgucmVwbGFjZShcInthY3Rpb259XCIsIFwiXCIpfWAsXG4gICAgICAgICAgICBpbnB1dFBhcmFtc1xuICAgICAgICAgIClcbiAgICAgICAgfSxcbiAgICAgICAgY2FsbGJhY2tcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRPRE86IGRvY3VtZW50XG4gICAqL1xuICBwc2QyKGlucHV0UGFyYW1zLCBjYWxsYmFjaykge1xuICAgIGlucHV0UGFyYW1zW1wiYXBpX2tleVwiXSA9IHRoaXMuY3JlZHMuYXBpS2V5O1xuICAgIGlucHV0UGFyYW1zW1wiYXBpX3NlY3JldFwiXSA9IHRoaXMuY3JlZHMuYXBpU2VjcmV0O1xuICAgIHRoaXMub3B0aW9ucy5odHRwQ2xpZW50LnJlcXVlc3QoXG4gICAgICB7XG4gICAgICAgIGhvc3Q6IHRoaXMub3B0aW9ucy5hcGlIb3N0IHx8IFwiYXBpLm5leG1vLmNvbVwiLFxuICAgICAgICBwYXRoOiBVdGlscy5jcmVhdGVQYXRoV2l0aFF1ZXJ5KFxuICAgICAgICAgIGAke1ZlcmlmeS5QQVRILnJlcGxhY2UoXCJ7YWN0aW9ufVwiLCBcIi9wc2QyXCIpfWAsXG4gICAgICAgICAgaW5wdXRQYXJhbXNcbiAgICAgICAgKVxuICAgICAgfSxcbiAgICAgIGNhbGxiYWNrXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUT0RPOiBkb2N1bWVudFxuICAgKi9cbiAgY2hlY2soaW5wdXRQYXJhbXMsIGNhbGxiYWNrKSB7XG4gICAgaWYgKCFpbnB1dFBhcmFtcy5yZXF1ZXN0X2lkIHx8ICFpbnB1dFBhcmFtcy5jb2RlKSB7XG4gICAgICBVdGlscy5zZW5kRXJyb3IoXG4gICAgICAgIGNhbGxiYWNrLFxuICAgICAgICBuZXcgRXJyb3IoVmVyaWZ5LkVSUk9SX01FU1NBR0VTLmNoZWNrVmVyaWZ5VmFsaWRhdGlvbilcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlucHV0UGFyYW1zW1wiYXBpX2tleVwiXSA9IHRoaXMuY3JlZHMuYXBpS2V5O1xuICAgICAgaW5wdXRQYXJhbXNbXCJhcGlfc2VjcmV0XCJdID0gdGhpcy5jcmVkcy5hcGlTZWNyZXQ7XG4gICAgICB0aGlzLm9wdGlvbnMuaHR0cENsaWVudC5yZXF1ZXN0KFxuICAgICAgICB7XG4gICAgICAgICAgaG9zdDogdGhpcy5vcHRpb25zLmFwaUhvc3QgfHwgXCJhcGkubmV4bW8uY29tXCIsXG4gICAgICAgICAgcGF0aDogVXRpbHMuY3JlYXRlUGF0aFdpdGhRdWVyeShcbiAgICAgICAgICAgIGAke1ZlcmlmeS5QQVRILnJlcGxhY2UoXCJ7YWN0aW9ufVwiLCBcIi9jaGVja1wiKX1gLFxuICAgICAgICAgICAgaW5wdXRQYXJhbXNcbiAgICAgICAgICApXG4gICAgICAgIH0sXG4gICAgICAgIGNhbGxiYWNrXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUT0RPOiBkb2N1bWVudFxuICAgKi9cbiAgY29udHJvbChpbnB1dFBhcmFtcywgY2FsbGJhY2spIHtcbiAgICBpZiAoIWlucHV0UGFyYW1zLnJlcXVlc3RfaWQgfHwgIWlucHV0UGFyYW1zLmNtZCkge1xuICAgICAgVXRpbHMuc2VuZEVycm9yKFxuICAgICAgICBjYWxsYmFjayxcbiAgICAgICAgbmV3IEVycm9yKFZlcmlmeS5FUlJPUl9NRVNTQUdFUy5jb250cm9sVmVyaWZ5VmFsaWRhdGlvbilcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlucHV0UGFyYW1zW1wiYXBpX2tleVwiXSA9IHRoaXMuY3JlZHMuYXBpS2V5O1xuICAgICAgaW5wdXRQYXJhbXNbXCJhcGlfc2VjcmV0XCJdID0gdGhpcy5jcmVkcy5hcGlTZWNyZXQ7XG4gICAgICB0aGlzLm9wdGlvbnMuaHR0cENsaWVudC5yZXF1ZXN0KFxuICAgICAgICB7XG4gICAgICAgICAgaG9zdDogdGhpcy5vcHRpb25zLmFwaUhvc3QgfHwgXCJhcGkubmV4bW8uY29tXCIsXG4gICAgICAgICAgcGF0aDogVXRpbHMuY3JlYXRlUGF0aFdpdGhRdWVyeShcbiAgICAgICAgICAgIGAke1ZlcmlmeS5QQVRILnJlcGxhY2UoXCJ7YWN0aW9ufVwiLCBcIi9jb250cm9sXCIpfWAsXG4gICAgICAgICAgICBpbnB1dFBhcmFtc1xuICAgICAgICAgIClcbiAgICAgICAgfSxcbiAgICAgICAgY2FsbGJhY2tcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRPRE86IGRvY3VtZW50XG4gICAqL1xuICBzZWFyY2gocmVxdWVzdElkcywgY2FsbGJhY2spIHtcbiAgICB2YXIgcmVxdWVzdElkUGFyYW0gPSB7fTtcbiAgICBpZiAoIXJlcXVlc3RJZHMpIHtcbiAgICAgIFV0aWxzLnNlbmRFcnJvcihcbiAgICAgICAgY2FsbGJhY2ssXG4gICAgICAgIG5ldyBFcnJvcihWZXJpZnkuRVJST1JfTUVTU0FHRVMuc2VhcmNoVmVyaWZ5VmFsaWRhdGlvbilcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlcXVlc3RJZHMpKSB7XG4gICAgICAgIGlmIChyZXF1ZXN0SWRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgIHJlcXVlc3RJZFBhcmFtLnJlcXVlc3RfaWQgPSByZXF1ZXN0SWRzO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcXVlc3RJZFBhcmFtLnJlcXVlc3RfaWRzID0gcmVxdWVzdElkcztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVxdWVzdElkUGFyYW0ucmVxdWVzdF9pZCA9IHJlcXVlc3RJZHM7XG4gICAgICB9XG4gICAgICByZXF1ZXN0SWRQYXJhbVtcImFwaV9rZXlcIl0gPSB0aGlzLmNyZWRzLmFwaUtleTtcbiAgICAgIHJlcXVlc3RJZFBhcmFtW1wiYXBpX3NlY3JldFwiXSA9IHRoaXMuY3JlZHMuYXBpU2VjcmV0O1xuICAgICAgdGhpcy5vcHRpb25zLmh0dHBDbGllbnQucmVxdWVzdChcbiAgICAgICAge1xuICAgICAgICAgIGhvc3Q6IHRoaXMub3B0aW9ucy5hcGlIb3N0IHx8IFwiYXBpLm5leG1vLmNvbVwiLFxuICAgICAgICAgIHBhdGg6IFV0aWxzLmNyZWF0ZVBhdGhXaXRoUXVlcnkoXG4gICAgICAgICAgICBgJHtWZXJpZnkuUEFUSC5yZXBsYWNlKFwie2FjdGlvbn1cIiwgXCIvc2VhcmNoXCIpfWAsXG4gICAgICAgICAgICByZXF1ZXN0SWRQYXJhbVxuICAgICAgICAgIClcbiAgICAgICAgfSxcbiAgICAgICAgY2FsbGJhY2tcbiAgICAgICk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFZlcmlmeTtcbiJdfQ==