"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _fs = _interopRequireDefault(require("fs"));

var _querystring = _interopRequireDefault(require("querystring"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

class Media {
  static get PATH() {
    return "/v3/media";
  }

  constructor(credentials, options) {
    this.creds = credentials;
    this.options = options;
  }

  upload(opts, callback) {
    opts = opts || {};

    if (!opts.file && !opts.url) {
      throw new Error("You must provide either 'file' or 'url' to upload a file");
    }

    if (opts.file) {
      opts.file = _fs.default.createReadStream(opts.file);
    }

    return this.options.api.postFile(Media.PATH, opts, function (err, response, body) {
      if (err) {
        return callback(err);
      }

      var location = "";

      if (response && response.headers) {
        location = response.headers.location;
      }

      return callback(null, location);
    }, true);
  }

  search(options, callback) {
    if (typeof options == "function" && !callback) {
      callback = options;
      options = {};
    }

    options = options || {};
    return this._makeRequest("GET", Media.PATH, options, {}, callback);
  } // If If-Modified-Since header is provided and the data hasn't changed, the
  // user will receive an empty body in the callback, NOT an error


  download(id, headers, callback) {
    if (!callback && typeof headers == "function") {
      callback = headers;
      headers = {};
    }

    return this._makeRequest("GET", "".concat(Media.PATH, "/").concat(id), {}, headers, callback, true);
  }

  delete(id, callback) {
    return this._makeRequest("DELETE", "".concat(Media.PATH, "/").concat(id), {}, {}, callback);
  }

  get(id, callback) {
    return this._makeRequest("GET", "".concat(Media.PATH, "/").concat(id, "/info"), {}, {}, callback);
  }

  update(id, opts, callback) {
    return this._makeRequest("PUT", "".concat(Media.PATH, "/").concat(id, "/info"), opts, {}, callback);
  }

  _makeRequest(verb, path, options, headers, callback, skipJsonParsing) {
    headers = Object.assign({
      "Content-Type": "application/json",
      Authorization: "Bearer ".concat(this.creds.generateJwt())
    }, headers);
    var req = {};

    if (verb.toUpperCase() === "GET") {
      if (Object.keys(options).length) {
        path = path + "?" + _querystring.default.stringify(options);
      }
    } else {
      req["body"] = JSON.stringify(options);
    }

    req["path"] = path;
    req["headers"] = headers;
    return this.options.api.request(req, verb, callback, skipJsonParsing);
  }

}

var _default = Media;
exports.default = _default;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9NZWRpYS5qcyJdLCJuYW1lcyI6WyJNZWRpYSIsIlBBVEgiLCJjb25zdHJ1Y3RvciIsImNyZWRlbnRpYWxzIiwib3B0aW9ucyIsImNyZWRzIiwidXBsb2FkIiwib3B0cyIsImNhbGxiYWNrIiwiZmlsZSIsInVybCIsIkVycm9yIiwiZnMiLCJjcmVhdGVSZWFkU3RyZWFtIiwiYXBpIiwicG9zdEZpbGUiLCJlcnIiLCJyZXNwb25zZSIsImJvZHkiLCJsb2NhdGlvbiIsImhlYWRlcnMiLCJzZWFyY2giLCJfbWFrZVJlcXVlc3QiLCJkb3dubG9hZCIsImlkIiwiZGVsZXRlIiwiZ2V0IiwidXBkYXRlIiwidmVyYiIsInBhdGgiLCJza2lwSnNvblBhcnNpbmciLCJPYmplY3QiLCJhc3NpZ24iLCJBdXRob3JpemF0aW9uIiwiZ2VuZXJhdGVKd3QiLCJyZXEiLCJ0b1VwcGVyQ2FzZSIsImtleXMiLCJsZW5ndGgiLCJxdWVyeXN0cmluZyIsInN0cmluZ2lmeSIsIkpTT04iLCJyZXF1ZXN0Il0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztBQUVBOztBQUNBOzs7O0FBRUEsTUFBTUEsS0FBTixDQUFZO0FBQ1YsYUFBV0MsSUFBWCxHQUFrQjtBQUNoQixXQUFPLFdBQVA7QUFDRDs7QUFFREMsRUFBQUEsV0FBVyxDQUFDQyxXQUFELEVBQWNDLE9BQWQsRUFBdUI7QUFDaEMsU0FBS0MsS0FBTCxHQUFhRixXQUFiO0FBQ0EsU0FBS0MsT0FBTCxHQUFlQSxPQUFmO0FBQ0Q7O0FBRURFLEVBQUFBLE1BQU0sQ0FBQ0MsSUFBRCxFQUFPQyxRQUFQLEVBQWlCO0FBQ3JCRCxJQUFBQSxJQUFJLEdBQUdBLElBQUksSUFBSSxFQUFmOztBQUNBLFFBQUksQ0FBQ0EsSUFBSSxDQUFDRSxJQUFOLElBQWMsQ0FBQ0YsSUFBSSxDQUFDRyxHQUF4QixFQUE2QjtBQUMzQixZQUFNLElBQUlDLEtBQUosQ0FDSiwwREFESSxDQUFOO0FBR0Q7O0FBRUQsUUFBSUosSUFBSSxDQUFDRSxJQUFU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WCxFQUFaO0FBRmYsS0FEUSxFQUtSZCxPQUxRLENBQVY7QUFRQSxRQUFJZSxHQUFHLEdBQUcsRUFBVjs7QUFDQSxRQUFJUCxJQUFJLENBQUNRLFdBQUwsT0FBdUIsS0FBM0IsRUFBa0M7QUFDaEMsVUFBSUwsTUFBTSxDQUFDTSxJQUFQLENBQVlqQyxPQUFaLEVBQXFCa0MsTUFBekIsRUFBaUM7QUFDL0JULFFBQUFBLElBQUksR0FBR0EsSUFBSSxHQUFHLEdBQVAsR0FBYVUscUJBQVlDLFNBQVosQ0FBc0JwQyxPQUF0QixDQUFwQjtBQUNEO0FBQ0YsS0FKRCxNQUlPO0FBQ0wrQixNQUFBQSxHQUFHLENBQUMsTUFBRCxDQUFILEdBQWNNLElBQUksQ0FBQ0QsU0FBTCxDQUFlcEMsT0FBZixDQUFkO0FBQ0Q7O0FBRUQrQixJQUFBQSxHQUFHLENBQUMsTUFBRCxDQUFILEdBQWNOLElBQWQ7QUFDQU0sSUFBQUEsR0FBRyxDQUFDLFNBQUQsQ0FBSCxHQUFpQmYsT0FBakI7QUFFQSxXQUFPLEtBQUtoQixPQUFMLENBQWFVLEdBQWIsQ0FBaUI0QixPQUFqQixDQUF5QlAsR0FBekIsRUFBOEJQLElBQTlCLEVBQW9DcEIsUUFBcEMsRUFBOENzQixlQUE5QyxDQUFQO0FBQ0Q7O0FBbkhTOztlQXNIRzlCLEsiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IGZzIGZyb20gXCJmc1wiO1xuaW1wb3J0IHF1ZXJ5c3RyaW5nIGZyb20gXCJxdWVyeXN0cmluZ1wiO1xuXG5jbGFzcyBNZWRpYSB7XG4gIHN0YXRpYyBnZXQgUEFUSCgpIHtcbiAgICByZXR1cm4gXCIvdjMvbWVkaWFcIjtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKGNyZWRlbnRpYWxzLCBvcHRpb25zKSB7XG4gICAgdGhpcy5jcmVkcyA9IGNyZWRlbnRpYWxzO1xuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG4gIH1cblxuICB1cGxvYWQob3B0cywgY2FsbGJhY2spIHtcbiAgICBvcHRzID0gb3B0cyB8fCB7fTtcbiAgICBpZiAoIW9wdHMuZmlsZSAmJiAhb3B0cy51cmwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgXCJZb3UgbXVzdCBwcm92aWRlIGVpdGhlciAnZmlsZScgb3IgJ3VybCcgdG8gdXBsb2FkIGEgZmlsZVwiXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChvcHRzLmZpbGUpIHtcbiAgICAgIG9wdHMuZmlsZSA9IGZzLmNyZWF0ZVJlYWRTdHJlYW0ob3B0cy5maWxlKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMub3B0aW9ucy5hcGkucG9zdEZpbGUoXG4gICAgICBNZWRpYS5QQVRILFxuICAgICAgb3B0cyxcbiAgICAgIGZ1bmN0aW9uKGVyciwgcmVzcG9uc2UsIGJvZHkpIHtcbiAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgIHJldHVybiBjYWxsYmFjayhlcnIpO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGxvY2F0aW9uID0gXCJcIjtcbiAgICAgICAgaWYgKHJlc3BvbnNlICYmIHJlc3BvbnNlLmhlYWRlcnMpIHtcbiAgICAgICAgICBsb2NhdGlvbiA9IHJlc3BvbnNlLmhlYWRlcnMubG9jYXRpb247XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gY2FsbGJhY2sobnVsbCwgbG9jYXRpb24pO1xuICAgICAgfSxcbiAgICAgIHRydWVcbiAgICApO1xuICB9XG5cbiAgc2VhcmNoKG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zID09IFwiZnVuY3Rpb25cIiAmJiAhY2FsbGJhY2spIHtcbiAgICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICAgIG9wdGlvbnMgPSB7fTtcbiAgICB9XG5cbiAgICBvcHRpb25zID0gb3B0aW9ucyB8fCB7fTtcblxuICAgIHJldHVybiB0aGlzLl9tYWtlUmVxdWVzdChcIkdFVFwiLCBNZWRpYS5QQVRILCBvcHRpb25zLCB7fSwgY2FsbGJhY2spO1xuICB9XG5cbiAgLy8gSWYgSWYtTW9kaWZpZWQtU2luY2UgaGVhZGVyIGlzIHByb3ZpZGVkIGFuZCB0aGUgZGF0YSBoYXNuJ3QgY2hhbmdlZCwgdGhlXG4gIC8vIHVzZXIgd2lsbCByZWNlaXZlIGFuIGVtcHR5IGJvZHkgaW4gdGhlIGNhbGxiYWNrLCBOT1QgYW4gZXJyb3JcbiAgZG93bmxvYWQoaWQsIGhlYWRlcnMsIGNhbGxiYWNrKSB7XG4gICAgaWYgKCFjYWxsYmFjayAmJiB0eXBlb2YgaGVhZGVycyA9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgIGNhbGxiYWNrID0gaGVhZGVycztcbiAgICAgIGhlYWRlcnMgPSB7fTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5fbWFrZVJlcXVlc3QoXG4gICAgICBcIkdFVFwiLFxuICAgICAgYCR7TWVkaWEuUEFUSH0vJHtpZH1gLFxuICAgICAge30sXG4gICAgICBoZWFkZXJzLFxuICAgICAgY2FsbGJhY2ssXG4gICAgICB0cnVlXG4gICAgKTtcbiAgfVxuXG4gIGRlbGV0ZShpZCwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gdGhpcy5fbWFrZVJlcXVlc3QoXCJERUxFVEVcIiwgYCR7TWVkaWEuUEFUSH0vJHtpZH1gLCB7fSwge30sIGNhbGxiYWNrKTtcbiAgfVxuXG4gIGdldChpZCwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gdGhpcy5fbWFrZVJlcXVlc3QoXG4gICAgICBcIkdFVFwiLFxuICAgICAgYCR7TWVkaWEuUEFUSH0vJHtpZH0vaW5mb2AsXG4gICAgICB7fSxcbiAgICAgIHt9LFxuICAgICAgY2FsbGJhY2tcbiAgICApO1xuICB9XG5cbiAgdXBkYXRlKGlkLCBvcHRzLCBjYWxsYmFjaykge1xuICAgIHJldHVybiB0aGlzLl9tYWtlUmVxdWVzdChcbiAgICAgIFwiUFVUXCIsXG4gICAgICBgJHtNZWRpYS5QQVRIfS8ke2lkfS9pbmZvYCxcbiAgICAgIG9wdHMsXG4gICAgICB7fSxcbiAgICAgIGNhbGxiYWNrXG4gICAgKTtcbiAgfVxuXG4gIF9tYWtlUmVxdWVzdCh2ZXJiLCBwYXRoLCBvcHRpb25zLCBoZWFkZXJzLCBjYWxsYmFjaywgc2tpcEpzb25QYXJzaW5nKSB7XG4gICAgaGVhZGVycyA9IE9iamVjdC5hc3NpZ24oXG4gICAgICB7XG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dGhpcy5jcmVkcy5nZW5lcmF0ZUp3dCgpfWBcbiAgICAgIH0sXG4gICAgICBoZWFkZXJzXG4gICAgKTtcblxuICAgIGxldCByZXEgPSB7fTtcbiAgICBpZiAodmVyYi50b1VwcGVyQ2FzZSgpID09PSBcIkdFVFwiKSB7XG4gICAgICBpZiAoT2JqZWN0LmtleXMob3B0aW9ucykubGVuZ3RoKSB7XG4gICAgICAgIHBhdGggPSBwYXRoICsgXCI/XCIgKyBxdWVyeXN0cmluZy5zdHJpbmdpZnkob3B0aW9ucyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlcVtcImJvZHlcIl0gPSBKU09OLnN0cmluZ2lmeShvcHRpb25zKTtcbiAgICB9XG5cbiAgICByZXFbXCJwYXRoXCJdID0gcGF0aDtcbiAgICByZXFbXCJoZWFkZXJzXCJdID0gaGVhZGVycztcblxuICAgIHJldHVybiB0aGlzLm9wdGlvbnMuYXBpLnJlcXVlc3QocmVxLCB2ZXJiLCBjYWxsYmFjaywgc2tpcEpzb25QYXJzaW5nKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBNZWRpYTtcbiJdfQ==